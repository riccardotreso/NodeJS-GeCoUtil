

var sql = require('mssql'); 

var config = {
    user: '...',
    password: '...',
    server: '...',
    database: '...'
}

String.prototype.format = function() {
    var args = arguments;
    return this.replace(/{(\d+)}/g, function(match, number) { 
      return typeof args[number] != 'undefined'
        ? args[number]
        : match
      ;
    });
};




GeCoModel = function(server, database, user, password) {
	
	//inizialize variable
	config.server = server;
	config.database = database;
	config.user = user;
	config.password = password;
	
};

GeCoModel.prototype.getConnection = function(callback, query) {
	var connection = new sql.Connection(config,function(err) {
		if(err) callback(err);
		else
		{
			var request = connection.request();
			
			request.query(query, function(err, recordset) {
				if(err) callback(err);
				else
				{
					callback(null,recordset);
				}
			});
		}
		
		
	
	});
};

GeCoModel.prototype.getUserById = function(callback, userId) {
	var query = "select * from ViewUtentiGruppiTestate where nomeutente like '%{0}%'".format(userId);
	
	console.log(query);
	
    this.getConnection(function(err, recordSet) {
      if( err ) callback(err)
      else {
		callback(null, recordSet);
      }
    }, query);
};





exports.GeCoModel = GeCoModel;